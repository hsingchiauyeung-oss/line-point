<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>LINE 集點 & 抽獎</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>LINE 集點 & 抽獎 Demo</h2>

  <div>
    <label>序號：</label>
    <input type="text" id="codeInput" placeholder="掃描或輸入序號">
    <button id="scanBtn">掃描 QR Code</button>
  </div>

  <p id="status"></p>
  <p id="result"></p>
  <button id="lotteryBtn" style="display:none;">🎁 我要抽獎</button>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzVIIzzvQReLkZS8yKIuRfeXC2L5ZiE_C9VUPceGO0p-7WSVuhgd7G70fmxLUKNK5YkBw/exec"; // 改成你的 Web App URL
    const LIFF_ID = "2009031692-gSna9Z1E"; // 改成你的 LIFF ID

    async function init() {
      await liff.init({ liffId: LIFF_ID });
    }

    init();

    // 掃描 QR Code，自動集點
    document.getElementById("scanBtn").onclick = async () => {
      try {
        const result = await liff.scanCodeV2();
        const code = result.value.trim();
        document.getElementById("codeInput").value = code;

        document.getElementById("status").innerText = "集點中...";

        // 自動集點 POST
        const res = await fetch(GAS_URL, {
          method: "POST",
          body: JSON.stringify({
            code: code,
            lineUserId: liff.getContext().userId
          })
        });

        const data = await res.json();
        document.getElementById("result").innerText = data.message;
        document.getElementById("status").innerText = "";

        // 如果點數 >=10 顯示抽獎按鈕
        const match = data.message.match(/目前 (\d+) 點/);
        if (match && parseInt(match[1]) >= 10) {
          document.getEleme

